{
	"name": "dataflow1",
	"properties": {
		"folder": {
			"name": "EDI-DESADV"
		},
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "SalesShptHeaderCSV",
						"type": "DatasetReference"
					},
					"name": "ReadFromSalesShptHeaderCSV"
				},
				{
					"dataset": {
						"referenceName": "SalesShptLineCSV",
						"type": "DatasetReference"
					},
					"name": "ReadFromSalesShipmentLine"
				}
			],
			"sinks": [],
			"transformations": [
				{
					"name": "JoinHeaderAndLine",
					"description": "Join header and lines"
				},
				{
					"name": "Select",
					"description": "Clean duplicate columns"
				},
				{
					"name": "AggregayeByDocNo",
					"description": "Aggregate header data"
				},
				{
					"name": "CreateBGM",
					"description": "Create BGM segment"
				},
				{
					"name": "CleanBGM",
					"description": "Clean BGM segment"
				}
			],
			"scriptLines": [
				"source(output(",
				"          ShipmentNo as integer,",
				"          SellToCustomerNo as string,",
				"          BillToCustomerNo as string,",
				"          BillToName as string,",
				"          PostingDate as string,",
				"          ShipmentDate as string,",
				"          ShopifyOrderNo as string",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     ignoreNoFilesFound: false) ~> ReadFromSalesShptHeaderCSV",
				"source(output(",
				"          DocumentNo as integer,",
				"          LineNo_ as integer,",
				"          ShipmentDate as string,",
				"          PostingDate as string,",
				"          SellToCustomerNo as string,",
				"          BillToCustomerNo as string,",
				"          LocationCode as string,",
				"          OrderNo as integer,",
				"          PurchaseOrderNo as string,",
				"          ItemNo as string,",
				"          ItemDescription as string,",
				"          UnitOfMeasure as string,",
				"          Quantity as double",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     ignoreNoFilesFound: false) ~> ReadFromSalesShipmentLine",
				"ReadFromSalesShptHeaderCSV, ReadFromSalesShipmentLine join(ShipmentNo == DocumentNo,",
				"     joinType:'inner',",
				"     matchType:'exact',",
				"     ignoreSpaces: false,",
				"     broadcast: 'auto')~> JoinHeaderAndLine",
				"JoinHeaderAndLine select(mapColumn(",
				"          ShipmentNo,",
				"          SellToCustomerNo = ReadFromSalesShptHeaderCSV@SellToCustomerNo,",
				"          BillToCustomerNo = ReadFromSalesShptHeaderCSV@BillToCustomerNo,",
				"          BillToName,",
				"          ShipmentDate = ReadFromSalesShptHeaderCSV@ShipmentDate,",
				"          LineNo_,",
				"          LocationCode,",
				"          OrderNo,",
				"          PurchaseOrderNo,",
				"          ItemNo,",
				"          ItemDescription,",
				"          UnitOfMeasure,",
				"          Quantity",
				"     ),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> Select",
				"Select aggregate(groupBy(ShipmentNo),",
				"     SellToCustomerNo = max(SellToCustomerNo),",
				"          BillToCustomerNo = max(BillToCustomerNo),",
				"          BillToName = max(BillToName),",
				"          ShipmentDate = max(ShipmentDate)) ~> AggregayeByDocNo",
				"AggregayeByDocNo derive(RecordOrder = 1,",
				"          LineOrder = 0,",
				"          SegmentOrder = 10,",
				"          LineText = concat(\r",
				"  rpad('BGM', 3, ' '),\r",
				"  rpad('03470550180', 35, ' '),\r",
				"  rpad(' ', 4, ' '),\r",
				"  rpad(' ', 14, ' '),\r",
				"  rpad(' ', 35, ' '),\r",
				"  rpad('ZZ', 4, ' '),\r",
				"  rpad(' ', 14, ' '),\r",
				"  'DESADV',\r",
				"  rpad(toString(ShipmentNo), 35 ,' '),\r",
				"  rpad(toString(ShipmentDate,'yyyyMMdd'), 8, ' '),\r",
				"  rpad(' ', 4, ' '),\r",
				"  rpad(' ', 8, ' '),\r",
				"  rpad('9 ', 3, ' ')\r",
				")\r",
				") ~> CreateBGM",
				"CreateBGM select(mapColumn(",
				"          RecordOrder,",
				"          LineOrder,",
				"          SegmentOrder,",
				"          LineText",
				"     ),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> CleanBGM"
			]
		}
	}
}